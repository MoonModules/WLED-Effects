{
  "meta": {"version": "0.3.0", "start":"program"},
  "program": ["PROGRAM","ID","block"],
  "block" : ["LCURL",{"*": ["statement"]},"RCURL"],
  "statement" : {"|":["variable","assign","function","call","for", "if","block"]},
  "variable" : ["VAR", "ID"],
  "assign" : ["varref","assignoperator", {"?":["expr"]}],
  "assignoperator": [{"|":["ASSIGN+", "ASSIGN-", "ASSIGN*", "ASSIGN/", "PLUSPLUS", "MINMIN", "ASSIGN"]}],
  "function" : ["FUNCTION", "ID", {"?": ["LPAREN", "formals", "RPAREN"]}, "block"],
  "formals" : {"?":["formal",{"*":["COMMA","formal"]}]},
  "formal" : "ID",
  "call" : ["ID", "LPAREN", "actuals", "RPAREN"],
  "actuals": {"?": ["expr", {"*": ["COMMA", "expr"]}]},
  "for": ["FOR", "LPAREN", "assign", "SEMI", "expr", "SEMI", "increment", "RPAREN", "block"],
  "increment": ["assign"],
  "if": ["IF", "LPAREN", "expr", "RPAREN", "block", {"?":["ELSE", "elseBlock"]}],
  "cex": ["QMARK", "expr", "QMARK", "trueExpr", "COLON", "falseExpr"],
  "elseBlock": ["block"],
  "trueExpr": ["expr"],
  "falseExpr": ["expr"],
  "expr" : [ "term", {"*": [{"|": ["PLUS", "MINUS", "EQ", "NEQ", "LT", "LTE", "GT", "GTE"]}, "term"]}],
  "term" : [ "factor", {"*": [{"|": ["MUL", "DIV", "MOD", "BSHIFTL", "BSHIFTR", "AND","OR"]}, "factor"]}],
  "factor" : {"|": [["MINUS", "factor"], "cex","call", "varref", "INTEGER_CONST", "REAL_CONST", ["LPAREN", "expr", "RPAREN"]]},
  "varref": ["ID", {"?": ["LBRACKET", "indices", "RBRACKET"]}],
  "indices" : ["expr", {"*": ["COMMA", "expr"]}],

  "TOKENS":
  {
    "ID": "ID",
    "INTEGER_CONST": "INTEGER_CONST",
    "REAL_CONST": "REAL_CONST",
    "PLUS": "+",
    "MINUS": "-",
    "MUL": "*",
    "DIV": "/",
    "MOD": "%",
    "BSHIFTL": "<<",
    "BSHIFTR": ">>",
    "LPAREN": "(",
    "RPAREN": ")",
    "LBRACKET": "[",
    "RBRACKET": "]",
    "COMMA": ",",
    "EQ": "==",
    "NEQ": "!=",
    "LT": "<",
    "LTE": "<=",
    "GT": ">",
    "GTE": ">=",
    "AND": "&&",
    "OR": "||",
    "SEMI": ";",
    "ASSIGN": "=",
    "ASSIGN+": "+=",
    "ASSIGN-": "-=",
    "ASSIGN*": "*=",
    "ASSIGN/": "/=",
    "PLUSPLUS": "++",
    "MINMIN": "--",

    "PROGRAM": "PROGRAM",
    "INTEGER": "INTEGER",
    "REAL": "REAL",
    "VAR": "VAR",
    "FUNCTION": "FUNCTION",
    "LCURL": "{",
    "RCURL": "}",
    "FOR": "FOR",
    "TO": "TO",
    "DO": "DO",
    "IF": "IF",
    "ELSE": "ELSE",
    "QMARK": "?",
    "COLON": ":"
  },

  "EXTERNALS":
  {
    "ledCount": {"return": "uint16"},
    "matrixWidth": {"return": "uint8"},
    "matrixHeight": {"return": "uint8"},
    "setPixelColor": {"pixelNr":"uint8", "color":"uint8"},
    "leds": {},
    "setPixels": {"leds": "array"},
    "hsv": {"h":"uint8", "s":"uint8", "v":"uint8"},

    "setRange": {"from":"uint16", "to":"uint16", "color":"uint32"},
    "fill": {"color":"uint32"},
    "colorBlend": {"color1":"uint32", "color2":"uint32", "blend":"uint16"},
    "colorWheel": {"pos":"uint8"},
    "colorFromPalette": {"index":"uint8", "brightness":"uint8"},
    "beatSin": { "bpm":"uint16", "lowest":"uint8", "highest":"uint8", "timebase":"uint32", "phase_offset":"uint8"},
    "fadeToBlackBy": {"fadeBy":"uint8"},
    "iNoise": {"x":"uint32", "y":"uint32"},
    "fadeOut": {"rate":"uint8"},

    "counter": {"return": "uint32"},
    "segcolor": {"index":"uint8"},
    "speedSlider": {"return":"uint8"},
    "intensitySlider": {"return":"uint8"},
    "custom1Slider": {"return":"uint8"},
    "custom2Slider": {"return":"uint8"},
    "custom3Slider": {"return":"uint8"},
    "sampleAvg": {"return": "double"},

    "shift": {"delta": "int"},
    "circle2D": {"degrees": "int"}, 

    "constrain": {"amt":"any", "low":"any", "high":"any"},
    "map": {"x":"int", "in_min":"int", "in_max":"int", "out_min":"int", "out_max":"int"},
    "seed": {"seed": "uint16"},
    "random": {"return": "uint16"},
    "sin": {"degrees": "double", "return": "double"},
    "cos": {"degrees": "double", "return": "double"},
    "abs": {"value": "double", "return": "double"},
    "min": {"value1": "double", "value2": "double", "return": "double"},
    "max": {"value1": "double", "value2": "double", "return": "double"},
    "floor": {"value": "double", "return": "double"},

    "hour": {"return":"uint8"},
    "minute": {"return":"uint8"},
    "second": {"return":"uint8"},
    "millis": {"return": "uint32"},

    "time": {"inVal":"double", "return": "double"},
    "triangle": {"t":"double", "return": "double"},
    "wave": {"v":"double", "return": "double"},
    "square": {"v":"double", "t":"double", "return": "double"},
    "clamp": {"d":"double", "min":"double", "max": "double"},

    "printf": {"args": "__VA_ARGS__"}
  }

}
